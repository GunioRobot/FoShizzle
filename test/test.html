<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<title>FoShizzle tests</title>
  <link rel="stylesheet" href="qunit.css">
</head>
<body>

	<h1 id="qunit-header">FoShizzle tests</h1>
	<h2 id="qunit-banner"></h2>
	<h2 id="qunit-userAgent"></h2>
	<ol id="qunit-tests"></ol>
	<div id="qunit-fixture"></div>

	<script src="qunit.js"></script>
	<script src="../fo-shizzle.js"></script>
	<script>


module('FoShizzle()');
test('Basic support', function(){
	equals(FoShizzle('(min-width:0)'), true, '(min-width:0)');
	equals(FoShizzle('not (min-width:0)'), false, 'not (min-width:0)');
	equals(FoShizzle('(min-width:50000px)'), false, '(min-width:50000px)');
	equals(FoShizzle('(max-weight: 3kg)'), false, '(max-weight: 3kg)');
});

module('FoShizzle.parse()');

test('Multiple queries', function(){
	same(FoShizzle.parse('only screen, not screen'), [{"query":"only screen","keyword":"only","media_type":"screen","expressions":[]}, {"query":"not screen","keyword":"not","media_type":"screen","expressions":[]}], 'only screen, not screen');
	same(FoShizzle.parse('screen and (width), not screen and (color)'), [{"query":"screen and (width)","keyword":null,"media_type":"screen","expressions":[{"prefix":null,"media_feature":"width","expr":null}]}, {"query":"not screen and (color)","keyword":"not","media_type":"screen","expressions":[{"prefix":null,"media_feature":"color","expr":null}]}], 'screen and (width), not screen and (color)');
});

test('Media query types', function(){
	same(FoShizzle.parse(''), [], '[empty string]');
	same(FoShizzle.parse('screen'), [{"query":"screen","keyword":null,"media_type":"screen","expressions":[]}], 'screen');
	same(FoShizzle.parse('not screen'), [{"query":"not screen","keyword":"not","media_type":"screen","expressions":[]}], 'not screen');
	same(FoShizzle.parse('only screen'), [{"query":"only screen","keyword":"only","media_type":"screen","expressions":[]}], 'only screen');
	same(FoShizzle.parse('only screen and (color)'), [{"query":"only screen and (color)","keyword":"only","media_type":"screen","expressions":[{"prefix":null,"media_feature":"color","expr":null}]}], 'only screen and (color)');
	same(FoShizzle.parse('(color) and (width) and (height)'), [{"query":"(color) and (width) and (height)","keyword":null,"media_type":null,"expressions":[{"prefix":null,"media_feature":"color","expr":null},{"prefix":null,"media_feature":"width","expr":null},{"prefix":null,"media_feature":"height","expr":null}]}], '(color) and (width) and (height)');
	same(FoShizzle.parse('only screen and (color) and (width) and (height)'), [{"query":"only screen and (color) and (width) and (height)","keyword":"only","media_type":"screen","expressions":[{"prefix":null,"media_feature":"color","expr":null},{"prefix":null,"media_feature":"width","expr":null},{"prefix":null,"media_feature":"height","expr":null}]}], 'only screen and (color) and (width) and (height)');
});

test('Expression types', function(){
	same(FoShizzle.parse('(width)'), [{"query":"(width)","keyword":null,"media_type":null,"expressions":[{"prefix":null,"media_feature":"width","expr":null}]}], '(width)');
	same(FoShizzle.parse('(width:0)'), [{"query":"(width:0)","keyword":null,"media_type":null,"expressions":[{"prefix":null,"media_feature":"width","expr":"0"}]}], '(width:0)');
	same(FoShizzle.parse('(min-width:0)'), [{"query":"(min-width:0)","keyword":null,"media_type":null,"expressions":[{"prefix":"min","media_feature":"width","expr":"0"}]}], '(max-width:0)');
	same(FoShizzle.parse('(max-width:0)'), [{"query":"(max-width:0)","keyword":null,"media_type":null,"expressions":[{"prefix":"max","media_feature":"width","expr":"0"}]}], '(min-width:0)');
});


test('Unsupported types & features', function(){
	same(FoShizzle.parse('tv-3d'), [], 'tv-3d');
	same(FoShizzle.parse('(foo)'), [{"query":"(foo)","keyword":null,"media_type":null,"expressions":[]}], '(foo)');

	FoShizzle.ignore_unsupported_media_types = false;
	FoShizzle.clear_cache('tv-3d');
	same(FoShizzle.parse('tv-3d'), [{"query":"tv-3d","keyword":null,"media_type":"tv-3d","expressions":[]}], 'tv-3d');
	FoShizzle.ignore_unsupported_media_types = true;

	FoShizzle.ignore_unsupported_media_features = false;
	FoShizzle.clear_cache('(foo)');
	same(FoShizzle.parse('(foo)'), [{"query":"(foo)","keyword":null,"media_type":null,"expressions":[{"prefix":null,"media_feature":"foo","expr":null}]}], '(foo)');
	FoShizzle.ignore_unsupported_media_features = true;

});

test('Parser caching', function(){
	same(FoShizzle.is_cached('cache'), false, 'not in cache');
	FoShizzle.parse('cache')
	same(FoShizzle.is_cached('cache'), true, 'in cache');
	FoShizzle.clear_cache('cache');
	same(FoShizzle.is_cached('cache'), false, 'not in cache after clearing query from cache');
	FoShizzle.parse('cache')
	FoShizzle.clear_cache();
	same(FoShizzle.is_cached('cache'), false, 'not in cache after clearing entire cache');

});

/*
test('Malformed queries', function(){
	same(FoShizzle.parse('(example, all,), speech'), [], '(example, all,), speech'); // should just be speech
	same(FoShizzle.parse('&test, screen'), [], '&test, screen'); // should just be screen
	same(FoShizzle.parse('all and (color) and(width)'), [], 'all and(color)');
	same(FoShizzle.parse('all and(color)'), [], 'all and(color)');
	same(FoShizzle.parse('test;,all'), [], 'test;,all');

});
*/

module('FoShizzle test_non_native');
test('Media types', function(){
	FoShizzle.native_support = false;
	ok(FoShizzle('all'), 'all');
	ok(FoShizzle('screen'), 'screen');
	ok(!FoShizzle('aural'), 'aural');
	ok(FoShizzle('only screen'), 'only screen');
	ok(!FoShizzle('not screen'), 'not screen');
	ok(FoShizzle('not aural'), 'not aural');
	ok(FoShizzle('screen, aural'), 'screen, aural');
	ok(!FoShizzle('not screen, aural'), 'not screen, aural');
	ok(FoShizzle('screen, not aural'), 'screen, not aural');
});

test('Media features', function(){
	
	FoShizzle.native_support = false;

	ok(FoShizzle('(width)'), '(width)');
	ok(!FoShizzle('(width:0)'), '(width:0)');
	ok(FoShizzle('(min-width)'), '(min-width)');
	ok(FoShizzle('(min-width:0)'), '(min-width:0)');
	ok(FoShizzle('(max-width)'), '(max-width)');
	ok(FoShizzle('(max-width:9000px)'), '(max-width:9000px)');

	ok(FoShizzle('(height)'), '(height)');
	ok(!FoShizzle('(height:0)'), '(height:0)');
	ok(FoShizzle('(min-height)'), '(min-height)');
	ok(FoShizzle('(min-height:0)'), '(min-height:0)');
	ok(FoShizzle('(max-height)'), '(max-height)');
	ok(FoShizzle('(max-height:9000px)'), '(max-height:9000px)');


	ok(FoShizzle('(device-width)'), '(device-width)');
	ok(!FoShizzle('(device-width:0)'), '(device-width:0)');
	ok(FoShizzle('(min-device-width)'), '(min-device-width)');
	ok(FoShizzle('(min-device-width:0)'), '(min-width:0)');
	ok(FoShizzle('(max-device-width)'), '(max-device-width)');
	ok(FoShizzle('(max-device-width:9000px)'), '(max-device-width:9000px)');

	ok(FoShizzle('(device-height)'), '(device-height)');
	ok(!FoShizzle('(device-height:0)'), '(device-height:0)');
	ok(FoShizzle('(min-device-height)'), '(min-device-height)');
	ok(FoShizzle('(min-device-height:0)'), '(min-device-height:0)');
	ok(FoShizzle('(max-device-height)'), '(max-device-height)');
	ok(FoShizzle('(max-device-height:9000px)'), '(max-device-height:9000px)');


	ok(FoShizzle('(resolution)'), '(resolution)');
	ok(!FoShizzle('(resolution:0dpi)'), '(resolution:0dpi)');
	ok(FoShizzle('(min-resolution)'), '(min-resolution)');
	ok(FoShizzle('(min-resolution:0dpi)'), '(min-resolution:0dpi)');
	ok(FoShizzle('(max-resolution)'), '(max-resolution)');
	ok(FoShizzle('(max-resolution:9000dpi)'), '(max-resolution:9000dpi)');
	ok(!FoShizzle('(resolution:0dpcm)'), '(resolution:0dpcm)');
	ok(FoShizzle('(min-resolution:0dpcm)'), '(min-resolution:0dpcm)');
	ok(FoShizzle('(max-resolution:9000dpcm)'), '(max-resolution:9000dpcm)');


	ok(FoShizzle('(orientation)'), '(orientation)');
	ok(FoShizzle('(orientation:landscape)'), '(orientation:landscape)');
	ok(!FoShizzle('(orientation:portrait)'), '(orientation:portrait)');
	ok(!FoShizzle('(min-orientation:portrait)'), '(min-orientation:portrait)');
	ok(!FoShizzle('(max-orientation:portrait)'), '(max-orientation:portrait)');


	ok(FoShizzle('(aspect-ratio)'), '(aspect-ratio)');
	ok(!FoShizzle('(aspect-ratio:0)'), '(aspect-ratio:0)');
	ok(!FoShizzle('(aspect-ratio:1/2)'), '(aspect-ratio:1/2)');
	ok(FoShizzle('(min-aspect-ratio)'), '(min-aspect-ratio)');
	ok(FoShizzle('(min-aspect-ratio:4/3)'), '(min-aspect-ratio:4/3)');
	ok(FoShizzle('(max-aspect-ratio)'), '(max-aspect-ratio)');
	ok(FoShizzle('(max-aspect-ratio:14/3)'), '(max-aspect-ratio:14/3)');


	ok(FoShizzle('(device-aspect-ratio)'), '(device-aspect-ratio)');
	//ok(FoShizzle('(device-aspect-ratio:16/10)'), '(device-aspect-ratio:16/10)');
	ok(!FoShizzle('(device-aspect-ratio:1/2)'), '(device-aspect-ratio:1/2)');
	ok(!FoShizzle('(device-aspect-ratio:0)'), '(device-aspect-ratio:0)');
	ok(FoShizzle('(min-device-aspect-ratio)'), '(min-device-aspect-ratio)');
	ok(FoShizzle('(min-device-aspect-ratio:4/3)'), '(min-device-aspect-ratio:4/3)');
	ok(FoShizzle('(max-device-aspect-ratio)'), '(max-device-aspect-ratio)');
	ok(FoShizzle('(max-device-aspect-ratio:14/3)'), '(max-device-aspect-ratio:14/3)');


	//ok(FoShizzle('(orientation)'), '(orientation)');

});

module('FoShizzle extensibility');
test('Media features', function(){
	FoShizzle.native_support = false;
	//ok(!FoShizzle('(min-foo:bar)'), '(min-foo:bar) before');
	ok(FoShizzle.clear_cache().add_feature('foo', function(p,e,t){return true;}).test('(min-foo:bar)'), '(min-foo:bar) after');
});

	</script>

</body>
</html>


